## 연관관계 매핑시 고려사항 3가지

### 다중성

- **다대일: `@ManyToOne`**
    - 가장 많이 사용하는 연관관계
    - 외래 키가 있는 쪽이 연관관계의 주인
    - 양쪽을 서로 참조하도록 개발
- **일대다: `@OneToMany`**
    - 일대다 단방향은 일대다(1:N)에서 일(1)이 연관관계의 주인
    - 테이블 일대다 관계는 항상 다(N) 쪽에 외래 키가 있음
    - @JoinColumn을 꼭 사용해야 함. 그렇지 않으면 조인 테이블 방식을 사용함(중간에 테이블을 하나 추가함
    - 일대다 단방향 매핑의 단점
        - 엔티티가 관리하는 외래 키가 다른 테이블에 있음
        - 연관관계 관리를 위해 추가로 UPDATE SQL 실행
- **일대일: `@OneToOne`**
    - 주 테이블이나 대상 테이블 중에 외래 키 선택 가능
        - 주 테이블에 외래 키
        - 대상 테이블에 외래 키
    - 외래 키에 데이터베이스 유니크(UNI) 제약조건 추가
    - **단방향 관계는 JPA 지원X**
    - 장점: 주 테이블만 조회해도 대상 테이블에 데이터가 있는지 확인 가능
    - 단점: 값이 없으면 외래 키에 null 허용
- **다대다: `@ManyToMany`**
    - 객체는 컬렉션을 사용해서 객체 2개로 다대다 관계 가능
    - **편리해 보이지만 실무에서 사용X**

### 단방향, 양방향

- 테이블
    - 외래 키 하나로 양쪽 조인 가능
    - 사실 방향이라는 개념이 없음
- 객체
    - 참조용 필드가 있는 쪽으로만 참조 가능
    - 한쪽만 참조하면 단방향
    - 양쪽이 서로 참조하면 양방향

### 연관관계의 주인

- 테이블은 외래 키 하나로 두 테이블이 연관관계를 맺음
- 객체 양방향 관계는 A->B, B->A 처럼 참조가 2군데
- 객체 양방향 관계는 참조가 2군데 있음. 둘중 테이블의 외래 키를 관리할 곳을 지정해야함
- 연관관계의 주인: 외래 키를 관리하는 참조
- 주인의 반대편: 외래 키에 영향을 주지 않음, 단순 조회만 가능

### @JoinColumn

외래키를 매핑할 때 사용

| 속성  | 설명 | 기본값 |
| --- | --- | --- |
| name | 매핑할 외래 키 이름 | 필드명 + _ + 참조하는 테이블의 기본 키 컬럼명 |
| referencedColumnName | 외래 키가 참조하는 대상 테이블의 컬럼명 | 참조하는 테이블의 기본
키 컬럼명 |
| unique
nullable insertable
updatable
columnDefinition
table | @Column의 속성과 같다. |  |

### @ManyToOne - 주요 속성

다대일 관계 매핑

| 속성  | 설명 | 기본값 |
| --- | --- | --- |
| optional | false로 설정하면 연관된 엔티티가 항상 있어야 한다. | true |
| fetch | 글로벌 페치 전략을 설정한다 | - @ManyToOne=FetchType.EAGER
- @OneToMany=FetchType.LAZY |
| cascade | 영속성 전이 기능을 사용한다. |  |
| targetEntity | 연관된 엔티티의 타입 정보를 설정한다. 이 기능은 거
의 사용하지 않는다. 컬렉션을 사용해도 제네릭으로 타입 정보를 알 수 있다. |  |

### @OneToMany - 주요 속성

다대일 관계 매핑

| 속성  | 설명 | 기본값 |
| --- | --- | --- |
| mappedBy | 연관관계의 주인 필드를 선택한다. | true |
| fetch | 글로벌 페치 전략을 설정한다 | - @ManyToOne=FetchType.EAGER
- @OneToMany=FetchType.LAZY |
| cascade | 영속성 전이 기능을 사용한다. |  |
| targetEntity | 연관된 엔티티의 타입 정보를 설정한다. 이 기능은 거
의 사용하지 않는다. 컬렉션을 사용해도 제네릭으로 타입 정보를 알 수 있다. |  |
